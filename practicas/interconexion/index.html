<!DOCTYPE html>
<html>

    <head>
        <title> Interconexión de servidores de bases de datos &middot; Alepetepórico Blog </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.54.0" />




<script src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">


<link rel="stylesheet" href="https://alepeteporico.github.io/css/nix.css">



<link rel="shortcut icon" href="/favicon.ico">



<link href="https://fonts.googleapis.com/css?family=Inconsolata%7COpen+Sans%7CConcert+One" rel="stylesheet">






    </head>

    <body>
        <header>
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse font-header">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
      <a class="navbar-brand" id="green-terminal" href='https://alepeteporico.github.io/'>
        blog@alepetepórico ~ $
      </a>
		</div>

		
		<div class="collapse navbar-collapse" id="navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a href='https://alepeteporico.github.io/'>/home/blog</a>
        </li>
        
				
				
				<li class="dropdown">
                    
            		<a href="https://alepeteporico.github.io/apuntes">~/apuntes</a>
            		
        		</li>
        		
				
				<li class="dropdown">
                    
            		<a href="https://alepeteporico.github.io/problemas">~/problemas</a>
            		
        		</li>
        		
				
				<li class="dropdown">
                    
            		<a href="https://alepeteporico.github.io/practicas">~/prácticas</a>
            		
        		</li>
        		

			</ul>
		</div>
	</div>
</nav>
</header>

        <div class="flex-wrapper">
            <div class="container wrapper">
                <h1><a href="https://alepeteporico.github.io/practicas/interconexion/">Interconexión de servidores de bases de datos</a></h1>
                <span class="post-date">2021-05-05 </span>
                <div class="post-content">
                    

<ul>
<li><p>Realizar un enlace entre dos servidores de bases de datos ORACLE, explicando la configuración necesaria en ambos extremos y demostrando su funcionamiento.</p></li>

<li><p>Realizar un enlace entre dos servidores de bases de datos Postgres, explicando la configuración necesaria en ambos extremos y demostrando su funcionamiento.</p></li>

<li><p>Realizar un enlace entre un servidor ORACLE y otro Postgres o MySQL empleando Heterogeneus Services, explicando la configuración necesaria en ambos extremos y demostrando su funcionamiento.</p></li>
</ul>

<h2 id="conexión-entre-oracle">Conexión entre ORACLE</h2>

<ul>
<li><p>Usaremos dos máquina vagrant con centos 8 e instalaremos oracle 19c en cada una.</p></li>

<li><p>Vamos conigurar el que será nuestro servidor en la máquina oracle1.</p>

<pre><code>[vagrant@oracle1 ~]$ cat /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora
SID_LIST_LISTENER=
  (SID_LIST=
    (SID_DESC=
      (GLOBAL_DBNAME=orcl)
      (ORACLE_HOME=/u01/app/oracle/product/19c/dbhome_1)
      (SID_NAME=orcl))
  )

LISTENER =
(DESCRIPTION_LIST =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    (ADDRESS = (PROTOCOL = TCP)(HOST = 172.22.100.15)(PORT = 1521))
  )
)
</code></pre></li>

<li><p>Seguidamente haremos lo mismo con nuestro cliente, oracle2.</p>

<pre><code>[vagrant@oracle2 ~]$ sudo cat /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora
LISTENER_ORCL =
 (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))

ORCL =
 (DESCRIPTION = Servidor ORACLE
    (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
    (CONNECT_DATA =
        (SERVER = DEDICATED)
        (SERVICE_NAME = orcl)
    )
 )

OracleServer =
 (DESCRIPTION = Servidor Oracle1
    (ADDRESS = (PROTOCOL = TCP)(HOST = 172.22.100.15)(PORT = 1521))
    (CONNECT_DATA =
        (SERVER = DEDICATED)
        (SERVICE_NAME = oracle2)
    )
</code></pre></li>
</ul>

<h2 id="conexión-entre-postgres">Conexión entre Postgres.</h2>

<ul>
<li><p>Usaremos dos máquinas vagrant con debian buster.</p></li>

<li><p>primero configuraremos postgres1 que nos servirá como servidor principal, el primer archivo que configuraremos será <code>/etc/postgresql/11/main/postgresql.conf</code> y podremos el listener a 0.</p>

<pre><code>listen_addresses = '0'
</code></pre></li>

<li><p>Seguidamente configuraremos <code>/etc/postgresql/11/main/pg_hba.conf</code> añadiendo la siguiente línea.</p>

<pre><code>host     all             all             0.0.0.0/0
</code></pre></li>

<li><p>Si queremos entrar a postgres ahora nos dará un error.</p>

<pre><code>vagrant@postgres1:~$ psql
psql: could not connect to server: No such file or directory
    Is the server running locally and accepting
    connections on Unix domain socket &quot;/var/run/postgresql/.s.PGSQL.5432&quot;?
</code></pre></li>

<li><p>Lo que deberemos hacer es crear un nuevo cluster ya que el que tenemos está apagado.</p>

<pre><code>vagrant@postgres1:~$ sudo pg_dropcluster --stop 11 main

root@postgres1:~# pg_createcluster --locale es_ES.UTF-8 --start 11 main
Creating new PostgreSQL cluster 11/main ...
/usr/lib/postgresql/11/bin/initdb -D /var/lib/postgresql/11/main --auth-local peer --auth-host md5 --locale es_ES.UTF-8
The files belonging to this database system will be owned by user &quot;postgres&quot;.
This user must also own the server process.

The database cluster will be initialized with locale &quot;es_ES.UTF-8&quot;.
The default database encoding has accordingly been set to &quot;UTF8&quot;.
The default text search configuration will be set to &quot;spanish&quot;.

Data page checksums are disabled.

fixing permissions on existing directory /var/lib/postgresql/11/main ... ok
creating subdirectories ... ok
selecting default max_connections ... 100
selecting default shared_buffers ... 128MB
selecting default timezone ... Etc/UTC
selecting dynamic shared memory implementation ... posix
creating configuration files ... ok
running bootstrap script ... ok
performing post-bootstrap initialization ... ok
syncing data to disk ... ok

Success. You can now start the database server using:

    pg_ctlcluster 11 main start

Ver Cluster Port Status Owner    Data directory              Log file
11  main    5432 online postgres /var/lib/postgresql/11/main /var/log/postgresql/postgresql-11-main.log
</code></pre></li>

<li><p>Podemos comprobar que ahora podemos entrar sin problemas.</p>

<pre><code>postgres@postgres1:~$ psql
psql (11.12 (Debian 11.12-0+deb10u1))
Type &quot;help&quot; for help.

postgres=#
</code></pre></li>

<li><p>Pasemos a nuestro cliente, postgres2 configuraremos los archivos <code>/etc/postgresql/11/main/postgresql.conf</code> y <code>/etc/postgresql/11/main/pg_hba.conf</code> tal como hicimos con el servidor.</p>

<pre><code>vagrant@postgres2:~$ cat /etc/postgresql/11/main/postgresql.conf
listen_addresses = '*'

vagrant@postgres2:~$ cat /etc/postgresql/11/main/pg_hba.conf 
host    all             all             0.0.0.0/0
host    all             all             all                     md5
</code></pre></li>

<li><p>Una permitido el acceso remoto en ambas vamos a proceder a crear bases de datos y usuarios.</p></li>
</ul>

<h4 id="postgres1">Postgres1</h4>

<pre><code>    postgres=# CREATE USER postgres1 WITH PASSWORD 'postgres1';
    CREATE ROLE
    postgres=# CREATE DATABASE prueba1;
    CREATE DATABASE
    postgres=# GRANT ALL PRIVILEGES ON DATABASE prueba1 to postgres1;
    GRANT

    prueba1=&gt; INSERT INTO Propietarios(NIF,Nombre,Apellidos,Cuota)
    prueba1-&gt; VALUES('61219065B','Mario','Gutiérrez Valencia',300);
    INSERT 0 1
    prueba1=&gt; 
    prueba1=&gt; INSERT INTO Propietarios(NIF,Nombre,Apellidos,Cuota)
    prueba1-&gt; VALUES('20015195C','Alexandra','Angulo Lamas',320);
    INSERT 0 1
    prueba1=&gt; 
    prueba1=&gt; INSERT INTO Propietarios(NIF,Nombre,Apellidos,Cuota)
    prueba1-&gt; VALUES ('19643077L','Miriam','Zafra Valencia',45);
    INSERT 0 1
    prueba1=&gt; 
    prueba1=&gt; INSERT INTO Propietarios(NIF,Nombre,Apellidos,Cuota)
    prueba1-&gt; VALUES ('33599573T','Josue','Reche de los Santos',50);
    INSERT 0 1
    prueba1=&gt; 
    prueba1=&gt; INSERT INTO Propietarios(NIF,Nombre,Apellidos,Cuota)
    prueba1-&gt; VALUES ('X4164637G','Christian','Lopez Reyes',50);
    INSERT 0 1
</code></pre>

<h4 id="postgres2">Postgres2</h4>

<pre><code>    postgres=# CREATE USER postgres2 WITH PASSWORD 'postgres2';
    CREATE ROLE
    postgres=# CREATE DATABASE prueba2;
    CREATE DATABASE
    postgres=# GRANT ALL PRIVILEGES ON DATABASE prueba2 to postgres2;
    GRANT

    prueba2=&gt; INSERT INTO Propietarios(NIF,Nombre,Apellidos,Cuota)
    prueba2-&gt; VALUES('61219235B','Juan','Sierra Garcia',300);
    INSERT 0 1
    prueba2=&gt; INSERT INTO Propietarios(NIF,Nombre,Apellidos,Cuota)
    prueba2-&gt; VALUES('23554567B','Martina','Delgado Ramos',250);
    INSERT 0 1
</code></pre>

<ul>
<li><p>Ahora hagamos la interconexión, en primer lugar en postgres1.</p>

<pre><code>prueba1=# create extension dblink;
CREATE EXTENSION

prueba1=&gt; SELECT * FROM dblink('dbname=prueba2 host=172.22.100.30 user=postgres2 password=postgres2, 'select * from Propietarios') AS Propietarios (NIF varchar, Nombre varchar, Apellidos varchar, Cuota numeric);
    nif    | nombre  |   apellidos   | cuota  
-----------+---------+---------------+--------
 61219235B | Juan    | Sierra Garcia | 300.00
 23554567B | Martina | Delgado Ramos | 250.00
</code></pre></li>

<li><p>Y en postgres2:</p>

<pre><code>prueba2=# create extension dblink;
CREATE EXTENSION

prueba2=&gt; SELECT * FROM dblink('dbname=prueba1 host=172.22.100.25 user=postgres1 password='postgres1', 'select * from Propietarios') AS Propietarios (NIF varchar, Nombre varchar, Apellidos varchar, Cuota numeric);
    nif    |  nombre   |      apellidos      | cuota  
-----------+-----------+---------------------+--------
 61219065B | Mario     | Gutiérrez Valencia  | 300.00
 20015195C | Alexandra | Angulo Lamas        | 320.00
 19643077L | Miriam    | Zafra Valencia      |  45.00
 33599573T | Josue     | Reche de los Santos |  50.00
 X4164637G | Christian | Lopez Reyes         |  50.00
</code></pre></li>
</ul>

<h2 id="conexión-oracle-19c-y-postgres">Conexión Oracle 19c y Postgres</h2>

<ul>
<li><p>Nuestro primer paso será instalar la paquetería necesaria para realizar esta conexión, ya tenemos los dos servidores operativos, así que realizemos este paso, empezemos con Oracle.</p>

<pre><code>[vagrant@oracle ~]$ sudo dnf install unixODBC postgresql-odbc
</code></pre></li>

<li><p>En el fichero <code>/etc/odbcinst.ini</code> se encuentra la información de todos los drivers que ofrece ODBC para interconectar bases de datos, comentaremos todo menos lo que este relacionado con postgres.</p>

<pre><code>[PostgreSQL]
Description     = ODBC for PostgreSQL
Driver          = /usr/lib/psqlodbcw.so
Setup           = /usr/lib/libodbcpsqlS.so
Driver64        = /usr/lib64/psqlodbcw.so
Setup64         = /usr/lib64/libodbcpsqlS.so
FileUsage   = 1
</code></pre></li>

<li><p>En el fichero <code>/etc/odbc.ini</code> introduciremos información de nuestro servidor postgres como puede ser la dirección IP donde se aloja o el nombre de usuario y contraseña para acceder entre otros.</p>

<pre><code>[PSQLU]
Debug           = 0
CommLog         = 0
ReadOnly        = 0
Driver          = PostgreSQL
Servername  = 172.22.100.25
Username        = remoto1
Password        = remoto1
Port            = 5432
Database        = prueba
Trace           = 0
TraceFile   = /tmp/sql.log
</code></pre></li>

<li></li>
</ul>

<h3 id="postgres">postgres</h3>

<ul>
<li><p>Instalamos la paquetería necesaria</p>

<pre><code>vagrant@postgres:~$ sudo apt install libaio1 postgresql-server-dev-all build-essential
</code></pre></li>

<li><p>Y descargamos los paquetes de oracle que necesitaremos a lo largo de esta configuración.</p>

<pre><code>postgres@postgres:~$ wget https://download.oracle.com/otn_software/linux/instantclient/211000/instantclient-sdk-linux.x64-21.1.0.0.0.zip

postgres@postgres:~$ wget https://download.oracle.com/otn_software/linux/instantclient/211000/instantclient-sqlplus-linux.x64-21.1.0.0.0.zip

postgres@postgres:~$ wget https://download.oracle.com/otn_software/linux/instantclient/211000/instantclient-basic-linux.x64-21.1.0.0.0.zip
</code></pre></li>

<li><p>Descomprimiremos usando <code>unzip</code> todos estos archivos y nos quedará una carpeta con todo el contenido.</p>

<pre><code>postgres@postgres:~$ ls -l
total 8
drwxr-xr-x 4 postgres postgres 4096 May 28 15:25 instantclient_21_1
</code></pre></li>

<li><p>Para que este proceso nos sea mas sencillo vamos a definir una serie de variables de rutas sobre archivos que necesitaremos.</p>

<pre><code>vagrant@postgres:~$ export ORACLE_HOME=/home/postgres/instantclient_21_1
vagrant@postgres:~$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ORACLE_HOME
vagrant@postgres:~$ export PATH=$PATH:$ORACLE_HOME
</code></pre></li>

<li><p>Realizamos una conexión</p></li>
</ul>

<p>vagrant@postgres:/home/postgres$ sqlplus c##ale/ale@172.22.100.15/ORCLCDB</p>

<p>SQL*Plus: Release 21.0.0.0.0 - Production on Fri May 28 15:33:56 2021
Version 21.1.0.0.0</p>

<p>Copyright &copy; 1982, 2020, Oracle.  All rights reserved.</p>

                </div>
                
                <div class="post-comments">
                    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "Alepetepórico" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                </div>
                
            </div>
            <footer class="footer text-center">
<p>Copyright &copy; 2021 Alepetepórico Blog -
<span class="credit">
	Powered by
	<a target="_blank" href="https://gohugo.io">Hugo</a>
	and
	<a target="_blank" href="https://github.com/LordMathis/hugo-theme-nix/">Nix</a> theme.
</span>
</p>
</footer>

        </div>
    </body>
